<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>选择寻找不公平样本的范围</title>

  <!-- Mobile Specific Metas
================================================== -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Construction Html5 Template">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name=author content="Themefisher">
    <meta name=generator content="Themefisher Constra HTML Template v1.0">


    <!-- Template styles -->
    <link rel="stylesheet" href="../css/style.css">

    <!-- element-ui 引入样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">



    <!-- ============== js ================= -->
    <!-- vue.js -->
    <script src="../js/vue.js"></script>
    <script src="https://unpkg.com/vue-router@4.0.15/dist/vue-router.global.js"></script>

    <!-- axios.js -->
    <script src="../plugins/axios/axios-0.18.0.js"></script>

    <!-- element-ui 组件库 -->
    <!-- 引入组件库 -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
</head>

<body>
<div class="body-inner" id="app">
    
    <el-container>
        <!-- Header -->
        <el-header>
            <h4>欢迎进入公平性审计实验</h4>
        </el-header>
        
        <!-- Main -->
        <el-main>
            <el-row :gutter="30">
                <el-col :span="12">
                    <div class="task-area">
                        <div class="task-title">
                            <h1>任务描述</h1>
                        </div>
                        <div class="task-content">
                            <p>
                                上述分类模型中可能存在不公平现象，即：两个非常相似的人，模型可能会给出截然不同的分类结果。尤其是当两个人可能仅仅是由于
                            一些敏感属性不同而导致分类结果不同时，分类器会对部分群体造成歧视。
                            </p>
                            <p>
                                出于审计的目的，我们希望能够找到模型分类不同的一对样本，定位系统中存在的歧视现象，作为模型存在歧视的证据。
                            </p>
                        </div>
                    </div>
                </el-col>
                <el-col :span="12">
                    <div class="task-area">
                        <div class="task-title">
                            <h1>选择寻找不公平样本的范围</h1>
                        </div>

                        <div class="task-content">
                            <div class="task-content-form">
                                <div class="task-form-description">
                                    <p>请在“性别”和“种族”之间选择，确定之后无法更改，之后请选择样本范围</p>
                                </div>
                                <div class="task-form-area">
                                    <el-row :gutter="30">
                                        <el-col :span="12">
                                            <el-select v-model="sensitive" :disabled="isDisabled" placeholder="请选择属性">
                                              <el-option label="种族" value="race_White"></el-option>
                                              <el-option label="性别" value="sex_Male"></el-option>
                                            </el-select>
                                        </el-col>
                                        <el-col :span="12">
                                            <el-button type="warning" @click="confirmSelection">确定 </el-button>
                                        </el-col>
                                    </el-row>

                                </div>
                            </div>
                        </div>

                        <div class="form-card">
                           <div class="task-form">


                            <el-form :model="form" :rules="rules" ref="form" labelclass="demo-form">
                              <p style="text-align: left; font-size: 14px; color: #606200;">
                                选择您关注的人群，您将在该人群范围内寻找不公平的样本
                              </p>

                                <div class="form-scope">
                                     <!-- 年龄 -->
                                    <el-row>
                                      <el-col class="label" :span="3">年龄</el-col>
                                      <el-col :span="10">
                                        <el-form-item prop="age.scope[0]">
                                          <el-input placeholder="最低" v-model.number="form['age'].scope[0]"></el-input>
                                        </el-form-item>
                                      </el-col>
                                      <el-col class="line" style="text-align: center;" :span="1">-</el-col>
                                      <el-col :span="10">
                                        <el-form-item prop="age.scope[1]">
                                          <el-input placeholder="最高" v-model.number="form['age'].scope[1]"></el-input>
                                        </el-form-item>
                                      </el-col>
                                    </el-row>

                                    <!-- 资产收益 -->
                                    <el-row>
                                      <el-col class="label" :span="3">资产收益</el-col>
                                      <el-col :span="10">
                                        <el-form-item prop="capital-gain.scope[0]">
                                          <el-input placeholder="最低" v-model="form['capital-gain'].scope[0]"></el-input>
                                        </el-form-item>
                                      </el-col>
                                      <el-col class="line" style="text-align: center;" :span="1">-</el-col>
                                      <el-col :span="10">
                                        <el-form-item prop="capital-gain.scope[1]">
                                          <el-input placeholder="最高" v-model="form['capital-gain'].scope[1]"></el-input>
                                        </el-form-item>
                                      </el-col>
                                    </el-row>

                                    <!-- 资产损失 -->
                                    <el-row>
                                      <el-col class="label" :span="3">资产损失</el-col>
                                      <el-col :span="10">
                                        <el-form-item prop="capital-loss.scope[0]">
                                          <el-input placeholder="最低" v-model="form['capital-loss'].scope[0]"></el-input>
                                        </el-form-item>
                                      </el-col>
                                      <el-col class="line" style="text-align: center;" :span="1">-</el-col>
                                      <el-col :span="10">
                                        <el-form-item prop="capital-loss.scope[1]">
                                          <el-input placeholder="最高" v-model="form['capital-loss'].scope[1]"></el-input>
                                        </el-form-item>
                                      </el-col>
                                    </el-row>

                                    <!-- 受教育时长 -->
                                    <el-row>
                                      <el-col class="label" :span="3">受教育时长</el-col>
                                      <el-col :span="10">
                                        <el-form-item prop="education-num.scope[0]">
                                          <el-input placeholder="最低" v-model="form['education-num'].scope[0]"></el-input>
                                        </el-form-item>
                                      </el-col>
                                      <el-col class="line" style="text-align: center;" :span="1">-</el-col>
                                      <el-col :span="10">
                                        <el-form-item prop="education-num.scope[1]">
                                          <el-input placeholder="最高" v-model="form['education-num'].scope[1]"></el-input>
                                        </el-form-item>
                                      </el-col>
                                    </el-row>

                                    <!-- 每周工作时长 -->
                                    <el-row>
                                      <el-col class="label" :span="3">每周工作时长</el-col>
                                      <el-col :span="10">
                                        <el-form-item prop="hours-per-week.scope[0]">
                                          <el-input placeholder="最低" v-model="form['hours-per-week'].scope[0]"></el-input>
                                        </el-form-item>
                                      </el-col>
                                      <el-col class="line" style="text-align: center;" :span="1">-</el-col>
                                      <el-col :span="10">
                                        <el-form-item prop="hours-per-week.scope[1]">
                                          <el-input placeholder="最高" v-model="form['hours-per-week'].scope[1]"></el-input>
                                        </el-form-item>
                                      </el-col>
                                    </el-row>

                                    <!-- 婚姻状况 -->
                                    <el-row>
                                      <el-col class="label" :span="3">婚姻状况</el-col>
                                      <el-col :span="21">
                                        <el-form-item prop="marital-status.scope">
                                          <el-checkbox-group v-model="form['marital-status'].scope">
                                              <el-checkbox
                                                   v-for="item in marital_status"
                                                  :key="item.value"
                                                  :label="item.value">
                                                  [[ item.label ]]
                                              </el-checkbox>
                                          </el-checkbox-group>
                                        </el-form-item>
                                      </el-col>
                                    </el-row>

                                    <!-- 工作类型 -->
                                    <el-row>
                                      <el-col class="label" :span="3">工作类型</el-col>
                                      <el-col :span="21">
                                        <el-form-item prop="workclass.scope">
                                          <el-checkbox-group v-model="form['workclass'].scope">
                                              <el-checkbox v-for="item in workclass" :key="item.value" :label="item.value">[[ item.label ]]</el-checkbox>

                                          </el-checkbox-group>
                                        </el-form-item>
                                      </el-col>
                                    </el-row>

                                    <!-- 性别 -->
                                    <el-row v-if="sensitive !== 'sex_Male'">
                                      <el-col class="label" :span="3">性别</el-col>
                                      <el-col :span="10">
                                        <el-form-item prop="sex_Male.scope[0]">
                                          <el-input placeholder="最低" v-model="form['sex_Male'].scope[0]"></el-input>
                                        </el-form-item>
                                      </el-col>
                                      <el-col class="line" style="text-align: center;" :span="1">-</el-col>
                                      <el-col :span="10">
                                        <el-form-item prop="sex_Male.scope[1]">
                                          <el-input placeholder="最高" v-model="form['sex_Male'].scope[1]"></el-input>
                                        </el-form-item>
                                      </el-col>
                                    </el-row>

                                    <!-- 种族 -->
                                    <el-row v-if="sensitive !== 'race_White'">
                                      <el-col class="label" :span="3">种族</el-col>
                                      <el-col :span="10">
                                        <el-form-item prop="race_White.scope[0]">
                                          <el-input placeholder="最低" v-model="form['race_White'].scope[0]"></el-input>
                                        </el-form-item>
                                      </el-col>
                                      <el-col class="line" style="text-align: center;" :span="1">-</el-col>
                                      <el-col :span="10">
                                        <el-form-item prop="race_White.scope[1]">
                                          <el-input placeholder="最高" v-model="form['race_White'].scope[1]"></el-input>
                                        </el-form-item>
                                      </el-col>
                                    </el-row>
                                </div>

                                <div class="button-area">
                                    <a href="page03/">

                                    </a>
                                    <el-button type="primary"  @click="submitForm('form')">提交</el-button>

                                </div>
                            </el-form>
                          </div>
                            
                        </div>
                            
                    </div>
                </el-col>
            </el-row>
           

            <div class="button-area">
                    <a href="/page03/">
                        <el-button type="primary"  @click="next">下一步</el-button>
                    </a>
                </div>
    
        </el-main>
    
        <!-- Footer -->
        <el-footer>Footer</el-footer>
    </el-container>



</div>
<!-- 创建Vue对象 -->
     <script>
         axios.get('/api/csrf/').then(response => {
              axios.defaults.headers.common['X-CSRFToken'] = response.data.csrfToken;
            });
        new Vue({
            el: "#app",
            delimiters:["[[", "]]"],
            data() {
                return {
                    sensitive: '',
                    isDisabled:false,
                    form: {
                         "age": {
                             label: "年龄",
                             scope:[1,90],
                             default_scope:[1,90],

                            },
                        "capital-gain": {
                          label: "资产收益",
                            scope:[0,99999],
                            default_scope:[0,99999],

                        },
                        "capital-loss": {
                          label: "资产损失",
                            scope:[0, 4356],
                            default_scope:[0, 4356],

                        },
                        "education-num": {
                          label: "受教育时长",
                            scope:[1,16],
                            default_scope:[1,16],

                        },
                        "hours-per-week": {
                          label: "每周工作时长",
                            scope:[1,99],
                            default_scope:[1,99],

                        },
                        "marital-status": {
                          label: "婚姻状况",
                          scope: [], // default value as array for multiple selection
                        },
                        "workclass": {
                          label: "工作类型",
                          scope: [], // default value as array for multiple selection
                        },
                        "sex_Male": {
                          label: "性别",
                            scope:[0, 1],
                            default_scope:[0, 1],

                        },
                        "race_White": {
                          label: "种族",
                            scope:[0, 1],
                            default_scope:[0, 1],
                        },
                    },
                    {# 婚姻状况 #}
                    marital_status:[
                        { value: 'Divorced', label: '离异'},
                        { value: 'Married-AF-spouse', label: '军人家属婚姻'},
                        { value: 'Married-civ-spouse', label: '普通婚姻'},
                        { value: 'Married-spouse-absent', label: '已婚但夫妻异地'},
                        { value: 'Never-married', label: '未婚'},
                        { value: 'Separated', label: '分居'},
                        { value: 'Widowed', label: '丧偶'},
                    ],
                    {# 工作类型 #}
                    workclass:[
                        { value: 'Federal-gov', label: '联邦政府雇员'},
                        { value: 'Local-gov', label: '地方政府雇员'},
                        { value: 'Private', label: '私营企业'},
                        { value: 'Self-emp-inc', label: '自雇（收入较高）'},
                        { value: 'Self-emp-not-inc', label: '自雇（收入一般）'},
                        { value: 'State-gov', label: '州政府雇员'},
                        { value: 'Without-pay', label: '无报酬'},

                    ],
                    rules: {
                    {#    age  #}
                         'age.scope[0]': [
                          { required: true, message: '请输入最低年龄', trigger: 'blur' },
                          { type: 'number', message: '年龄必须为数字', trigger: 'blur', transform: value => Number(value) },
                          {#{ validator: this.validateRange('age',0,90), trigger: 'blur' }#}
                          { validator: this.validateRange('age',0,90), trigger: 'blur' }
                        ],
                         'age.scope[1]': [
                          { required: true, message: '请输入最高年龄', trigger: 'blur' },
                          { type: 'number', message: '年龄必须为数字', trigger: 'blur', transform: value => Number(value) },
                          { validator: this.validateRange('age',0, 90), trigger: 'blur' }
                        ],
                        {#    capital-gain  #}
                         'capital-gain.scope[0]': [
                          { required: true, message: '请输入最低年龄', trigger: 'blur' },
                          { type: 'number', message: '年龄必须为数字', trigger: 'blur', transform: value => Number(value) },
                          { validator: this.validateRange('age',0,90), trigger: 'blur' }
                          {#{ validator: this.validateRange('age','age',this.form.age.scope[0],this.form.age.scope[1]), trigger: 'blur' }#}
                        ],
                         'capital-gain.scope[1]': [
                          { required: true, message: '请输入最高年龄', trigger: 'blur' },
                          { type: 'number', message: '年龄必须为数字', trigger: 'blur', transform: value => Number(value) },
                          { validator: this.validateRange('age',0,90), trigger: 'blur' }
                        ],
                        {#    capital-loss  #}
                         'capital-loss.scope[0]': [
                          { required: true, message: '请输入最低年龄', trigger: 'blur' },
                          { type: 'number', message: '年龄必须为数字', trigger: 'blur', transform: value => Number(value) },
                          { validator: this.validateRange('age',0,90), trigger: 'blur' }
                          {#{ validator: this.validateRange('age','age',this.form.age.scope[0],this.form.age.scope[1]), trigger: 'blur' }#}
                        ],
                         'capital-loss.scope[1]': [
                          { required: true, message: '请输入最高年龄', trigger: 'blur' },
                          { type: 'number', message: '年龄必须为数字', trigger: 'blur', transform: value => Number(value) },
                          { validator: this.validateRange('age',0,90), trigger: 'blur' }
                        ],
                        {#    education-num  #}
                         'education-num.scope[0]': [
                          { required: true, message: '请输入最低年龄', trigger: 'blur' },
                          { type: 'number', message: '年龄必须为数字', trigger: 'blur', transform: value => Number(value) },
                          { validator: this.validateRange('age',0,90), trigger: 'blur' }
                          {#{ validator: this.validateRange('age','age',this.form.age.scope[0],this.form.age.scope[1]), trigger: 'blur' }#}
                        ],
                         'education-num.scope[1]': [
                          { required: true, message: '请输入最高年龄', trigger: 'blur' },
                          { type: 'number', message: '年龄必须为数字', trigger: 'blur', transform: value => Number(value) },
                          { validator: this.validateRange('age',0,90), trigger: 'blur' }
                        ],
                        {#    hours-per-week  #}
                         'hours-per-week.scope[0]': [
                          { required: true, message: '请输入最低年龄', trigger: 'blur' },
                          { type: 'number', message: '年龄必须为数字', trigger: 'blur', transform: value => Number(value) },
                          { validator: this.validateRange('age',0,90), trigger: 'blur' }
                          {#{ validator: this.validateRange('age','age',this.form.age.scope[0],this.form.age.scope[1]), trigger: 'blur' }#}
                        ],
                         'hours-per-week.scope[1]': [
                          { required: true, message: '请输入最高年龄', trigger: 'blur' },
                          { type: 'number', message: '年龄必须为数字', trigger: 'blur', transform: value => Number(value) },
                          { validator: this.validateRange('age',0,90), trigger: 'blur' }
                        ],
                        {#    sex_Male  #}
                         'sex_Male.scope[0]': [
                          { required: true, message: '请输入最低年龄', trigger: 'blur' },
                          { type: 'number', message: '年龄必须为数字', trigger: 'blur', transform: value => Number(value) },
                          { validator: this.validateRange('age',0,90), trigger: 'blur' }
                          {#{ validator: this.validateRange('age','age',this.form.age.scope[0],this.form.age.scope[1]), trigger: 'blur' }#}
                        ],
                         'sex_Male.scope[1]': [
                          { required: true, message: '请输入最高年龄', trigger: 'blur' },
                          { type: 'number', message: '年龄必须为数字', trigger: 'blur', transform: value => Number(value) },
                          { validator: this.validateRange('age',0,90), trigger: 'blur' }
                        ],
                        {#    race_White  #}
                         'race_White.scope[0]': [
                          { required: true, message: '请输入最低年龄', trigger: 'blur' },
                          { type: 'number', message: '年龄必须为数字', trigger: 'blur', transform: value => Number(value) },
                          { validator: this.validateRange('age',0,90), trigger: 'blur' }
                          {#{ validator: this.validateRange('age','age',this.form.age.scope[0],this.form.age.scope[1]), trigger: 'blur' }#}
                        ],
                         'race_White.scope[1]': [
                          { required: true, message: '请输入最高年龄', trigger: 'blur' },
                          { type: 'number', message: '年龄必须为数字', trigger: 'blur', transform: value => Number(value) },
                          { validator: this.validateRange('age',0,90), trigger: 'blur' }
                        ],
                    {# 婚姻状况 #}
                        'marital-status.scope': [
                          { type: 'array', required: true, message: '请选择婚姻状况', trigger: 'change' },
                        ],
                        {# 婚姻状况 #}
                        'workclass.scope': [
                          { type: 'array', required: true, message: '请选择婚姻状况', trigger: 'change' },
                        ],



                    },



                };
            },
            created() {

            },
            methods: {
                {# 确认表单 #}
                confirmSelection(){
                  this.$confirm('您确定选择此属性吗？一旦确认不可更改', '确认',{
                      confirmButtonText: '确定',
                      cancelButtonText: '取消',
                      type: 'warning'
                  }).then(()=>{
                      if (this.sensitive === "sex_Male") {
                          axios.post("/api/exp02/",{ action: 'set_sensitive_attr', data: "sex" })
                          .then(response =>{
                              console.log(response.data)
                          })
                        this.form.sex_Male.scope[0] = 0;
                        this.form.sex_Male.scope[1] = 1;
                      } else if (this.sensitive === "race_White") {
                        axios.post("/api/exp02/",{ action: 'set_sensitive_attr', data: "race" })
                          .then(response =>{
                              console.log(response.data)
                          })
                        this.form.race_White.scope[0] = 0;
                        this.form.race_White.scope[1] = 1;
                      }

                      this.isDisabled = true;
                      console.log(this.sensitive)
                      this.$message({
                          type:'success',
                          message: '已确认，选择已禁用！'
                      });
                  }).catch(()=>{
                      this.$message({
                          type: 'info',
                          message: '取消操作'
                        });
                  })
                },
                submitForm(formName) {
                    console.log(formName);
                    console.log(this.form.age)
                    this.$refs[formName].validate((valid) => {
                        if (valid) {
                            axios.post("/api/exp02/",{ action: 'set_range', data: this.form })
                                .then(response =>{
                                    console.log(response.data)
                                })
                            alert('submit!');
                            {#window.location.href = 'page03/';#}
                        } else {
                        console.log('error submit!!');
                        return false;
                        }
                    });
                    },
                resetForm(formName) {
                this.$refs[formName].resetFields();
                },

            {#    数值型通用规则#}
                validateRange(Prop, minLimit, maxLimit){
                  return (rule,value,callback)=>{
                      const min = this.form[Prop].scope[0];
                      const max = this.form[Prop].scope[1];
                      if(value < minLimit){
                          callback(new Error(`最低值不能小于${minLimit}`));
                      }else if(value > maxLimit){
                          callback(new Error(`最高值不能大于${maxLimit}`));
                      }else if(min >= max){
                          callback(new Error(`最低值必须小于最高值`));
                      }else{
                          callback()
                      }

                  }
                },
            {#    年龄规则 #}
                validateMin(rule, value, callback){
                    if (value < 0){
                        callback(new Error('最低年龄不能小于0'));
                    }else if(value >= this.form['age'].scope[1]){
                        callback(new Error('最低年龄必须小于最高年龄'))
                    }else{
                        callback();
                    }
                },
                validateMax(rule, value, callback) {
                  if (value > 90) {
                    callback(new Error('最高年龄不能大于90'));
                  } else if (value <= this.form.age.scope[0]) {
                    callback(new Error('最高年龄必须大于最低年龄'));
                  } else {
                    callback();
                  }
                },

            },
            });



     </script>
</body>

</html>