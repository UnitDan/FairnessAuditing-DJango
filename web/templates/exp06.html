<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>提交不公平样本</title>

    <!-- Mobile Specific Metas
================================================== -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Construction Html5 Template">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name=author content="Themefisher">
    <meta name=generator content="Themefisher Constra HTML Template v1.0">


    <!-- Template styles -->
    <link rel="stylesheet" href="../static/css/style.css">

    <!-- element-ui 引入样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">

    <!-- ============== js ================= -->
    <!-- vue.js -->
    <script src="../static/js/vue.js"></script>

    <!-- axios.js -->
    <script src="../static/plugins/axios/axios-0.18.0.js"></script>

    <!-- element-ui 组件库 -->
    <!-- 引入组件库 -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>


</head>

<body>
    <div class="body-inner" id="app">

        <el-container>
            <!-- Header -->
            <header class="fixed-header">
                <h2>欢迎进入公平性审计实验</h2>
            </header>

            <!-- Main -->
            <el-main>
                <div class="main-contanier">
                    <div class="task-area">
                        <div class="task-title">

                        </div>
                        <div class="task-content">
                            <div class="task-content-form">
                                <div class="task-form-area">
                                    <el-row>
                                        <el-col :span="18">
                                            <div class="task-form-title">
                                                <h2 style="margin-top: 0;">审计报告</h2>
                                            </div>
                                            <div class="form-card" v-loading="loading" element-loading-text="正在生成审计报告，大概需要一分钟~"
                                            element-loading-spinner="el-icon-loading"
                                            element-loading-background="rgba(255, 255, 255, 0.4)">
                                                <p>在xxx数据范围中，根据[[xxx]]的公平性准则，发现不公平样本如下：</p>
                                                <div class="card-text">
                                                     <!-- <div v-if="inFairnessPairs.length === 0">没有不公平的样本对</div> -->
                                                    <div>
                                                        <el-row>
                                                            <el-col :span="12">
                                                                <el-descriptions title="数据1" :column="2">
                                                                    <el-descriptions-item v-for="(value, key) in form1"
                                                                        :key="key" :label="getLabel(key)">
                                                                        [[ formatValue(key,value) ]]
                                                                    </el-descriptions-item>
                                                                </el-descriptions>
                                                            </el-col>
                                                            <el-col :span="12">
                                                                <el-descriptions title="数据2" :column="2">
                                                                    <el-descriptions-item v-for="(value, key) in form2"
                                                                        :key="key" :label="getLabel(key)">
                                                                        [[ formatValue(key,value) ]]
                                                                    </el-descriptions-item>
                                                                </el-descriptions>
                                                            </el-col>
                                                        </el-row>

                                                    </div>
                                                </div>
                                                <div class="task-content">
                                                    <div class="task-content-description">
                                                        <p>经进一步审计,该对样本附近,模型的个体公平性为
                                                            <b>
                                                            [[ old_individual_fairness]]
                                                            </b>
                                                            ，低于模型在总体数据上的公平性表现
                                                            <b>
                                                                [[ globalFairness ]]
                                                            </b>

                                                        </p>

                                                        <p>模型优化建议：采用
                                                            <b>[[optimization]]</b>
                                                            的优化方法
                                                        </p>
                                                        <br>
                                                        <p>优化完成后预计的公平性表现预计为：
                                                            <b>[[ new_individual_fairness ]]</b>
                                                        </p>
                                                    </div>
                                                </div>

                                            </div>
                                        </el-col>

                                        <el-col :span="6">

                                        </el-col>
                                    </el-row>
                                </div>
                            </div>
                        </div>

                        <div class="jump-area">
                            <div class="button-area">
                                <a href="/">
                                    <el-button type="warning" @click="exit">结束</el-button>
                                </a>
                            </div>
                        </div>

                    </div>
                </div>

            </el-main>

        </el-container>

    </div>

    <!-- 创建Vue对象 -->
    <script>
        axios.get('/api/csrf/').then(response => {
            axios.defaults.headers.common['X-CSRFToken'] = response.data.csrfToken;
        });

        new Vue({
            el: "#app",
            delimiters: ["[[", "]]"],
            data() {
                return {
                    loading: false,
                    inFairnessPairs: [],
                    fairness: '公平',
                    optimization: 'xxx',
                    old_individual_fairness: 'be loading...',
                    new_individual_fairness: 'be loading...',
                    globalFairness: '',
                    form1: {
                        'age': '',
                        'capital-gain': '',
                        'capital-loss': '',
                        'education-num': '',
                        'hours-per-week': '',
                        'race_White': '',
                        'sex_Male': '',
                        'marital-status': '',
                        'workclass': ''
                    },
                    form2: {
                        'age': '',
                        'capital-gain': '',
                        'capital-loss': '',
                        'education-num': '',
                        'hours-per-week': '',
                        'race_White': '',
                        'sex_Male': '',
                        'marital-status': '',
                        'workclass': ''
                    },
                    labels: {
                        'age': '年龄',
                        'capital-gain': '资本收益',
                        'capital-loss': '资本损失',
                        'education-num': '受教育时间',
                        'hours-per-week': '每周工作时间',
                        'race_White': '种族',
                        'sex_Male': '性别',
                        'marital-status': '婚姻情况',
                        'workclass': '工作场所'
                    },
                    maritalStatusOptions: [
                        { value: 'Divorced', label: '离异' },
                        { value: 'Married-AF-spouse', label: '军人家属婚姻' },
                        { value: 'Married-civ-spouse', label: '普通婚姻' },
                        { value: 'Married-spouse-absent', label: '已婚但夫妻异地' },
                        { value: 'Never-married', label: '未婚' },
                        { value: 'Separated', label: '分居' },
                        { value: 'Widowed', label: '丧偶' }
                    ],
                    workclassOptions: [
                        { value: 'Federal-gov', label: '联邦政府雇员' },
                        { value: 'Local-gov', label: '地方政府雇员' },
                        { value: 'Private', label: '私营企业' },
                        { value: 'Self-emp-inc', label: '自雇（收入较高）' },
                        { value: 'Self-emp-not-inc', label: '自雇（收入一般）' },
                        { value: 'State-gov', label: '州政府雇员' },
                        { value: 'Without-pay', label: '无报酬' }
                    ]
                };
            },
            created() {
                this.fetchData();
            },
            computed: {

            },
            methods: {
                getLabel(key) {
                    return this.labels[key] || key;
                },
                formatValue(key, value) {
                    if (key === "race_White") {
                        return value === 1 ? '白人' : '非白人';
                    } else if (key === 'sex_Male') {
                        return value === 1 ? '男性' : '女性';
                    } else if (key === 'marital-status') {
                        return this.getOptionLabel(this.maritalStatusOptions, value);
                    } else if (key === 'workclass') {
                        return this.getOptionLabel(this.workclassOptions, value);
                    } else {
                        return value;
                    }
                },
                getOptionLabel(options, value) {
                    const option = options.find(option => option.value === value);
                    return option ? option.label : value;
                },
                fetchData() {
                    this.loading = true;
                    console.log('进入前，loading = ' + this.loading);
                    axios.get("/api/exp06/").then(response => {
                        this.form1 = response.data.unfair_pair[0];
                        this.form2 = response.data.unfair_pair[1];
                        this.old_individual_fairness = response.data.individual_fairness.toFixed(4);
                        this.new_individual_fairness = response.data.new_individual_fairness.toFixed(4);
                        console.log(this.old_individual_fairness);
                        console.log(this.new_individual_fairness);
                        this.globalFairness = 0.6773
                        this.loading = false;
                        console.log('加载完成，loading = ' + this.loading);

                    }).catch(error => {
                        console.error("There was an error fetching the data:", error);
                        this.loading = false;  // 即使发生错误，也需要设置 loading 为 false
                    });
                },
                exit() {
                    alert("结束！")
                }
            }
        })


    </script>
</body>

</html>